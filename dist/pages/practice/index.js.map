{"version":3,"file":"pages/practice/index.js","mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACJA;AACA;AACA;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC1BA;AACA;AACA;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://wx-english-dictation/./src/pages/practice/index.tsx?5982","webpack://wx-english-dictation/._src_pages_practice_index.tsx","webpack://wx-english-dictation/._node_modules_@babel_runtime_helpers_esm_arrayLikeToArray.js","webpack://wx-english-dictation/._node_modules_@babel_runtime_helpers_esm_arrayWithHoles.js","webpack://wx-english-dictation/._node_modules_@babel_runtime_helpers_esm_iterableToArrayLimit.js","webpack://wx-english-dictation/._node_modules_@babel_runtime_helpers_esm_nonIterableRest.js","webpack://wx-english-dictation/._node_modules_@babel_runtime_helpers_esm_slicedToArray.js","webpack://wx-english-dictation/._node_modules_@babel_runtime_helpers_esm_unsupportedIterableToArray.js"],"sourcesContent":["import _slicedToArray from \"/Users/jessie.chen/project/wx-english-dictation/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { View, Input, Button, Text, Image, Slider, Switch } from \"@tarojs/components\";\nimport { useRouter } from \"@tarojs/taro\";\nimport { observer } from \"mobx-react\";\nimport { useStore } from \"../../store\";\nimport \"./index.scss\";\nimport Taro from \"@tarojs/taro\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nvar Practice = function Practice() {\n  var _sentenceStore$audioL3;\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    userInput = _useState2[0],\n    setUserInput = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isPlaying = _useState4[0],\n    setIsPlaying = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    autoPlay = _useState6[0],\n    setAutoPlay = _useState6[1];\n  var _useState7 = useState(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    isSlowMode = _useState8[0],\n    setIsSlowMode = _useState8[1];\n  var _useState9 = useState(\"\"),\n    _useState10 = _slicedToArray(_useState9, 2),\n    audioError = _useState10[0],\n    setAudioError = _useState10[1];\n  var _useState11 = useState(false),\n    _useState12 = _slicedToArray(_useState11, 2),\n    showAnswer = _useState12[0],\n    setShowAnswer = _useState12[1];\n  var _useState13 = useState(\"\"),\n    _useState14 = _slicedToArray(_useState13, 2),\n    checkResult = _useState14[0],\n    setCheckResult = _useState14[1];\n  var _useState15 = useState(0),\n    _useState16 = _slicedToArray(_useState15, 2),\n    currentTime = _useState16[0],\n    setCurrentTime = _useState16[1];\n  var _useState17 = useState(0),\n    _useState18 = _slicedToArray(_useState17, 2),\n    duration = _useState18[0],\n    setDuration = _useState18[1];\n  var audioContext = useRef();\n  var router = useRouter();\n  var _useStore = useStore(),\n    sentenceStore = _useStore.sentenceStore;\n\n  // 加载数据\n  useEffect(function () {\n    sentenceStore.fetchAudioList().then(function () {\n      var _sentenceStore$audioL;\n      // 确保有数据后设置第一题\n      if (((_sentenceStore$audioL = sentenceStore.audioList) === null || _sentenceStore$audioL === void 0 ? void 0 : _sentenceStore$audioL.length) > 0) {\n        sentenceStore.setCurrentAudio(sentenceStore.audioList[0]);\n      }\n    });\n  }, []);\n  useEffect(function () {\n    initAudioContext();\n    return function () {\n      if (audioContext.current) {\n        audioContext.current.destroy();\n      }\n    };\n  }, []);\n\n  // 初始化音频上下文\n  var initAudioContext = function initAudioContext() {\n    if (!audioContext.current) {\n      audioContext.current = Taro.createInnerAudioContext();\n      audioContext.current.src = '/assets/audio/common_voice_en_40865211.mp3';\n      audioContext.current.playbackRate = 1.0;\n      audioContext.current.autoplay = false;\n\n      // 音频状态监听\n      audioContext.current.onPlay(function () {\n        console.log(\"开始播放\");\n        setIsPlaying(true);\n        setAudioError(\"\");\n      });\n      audioContext.current.onPause(function () {\n        console.log(\"暂停播放\");\n        setIsPlaying(false);\n      });\n      audioContext.current.onStop(function () {\n        console.log(\"停止播放\");\n        setIsPlaying(false);\n      });\n      audioContext.current.onEnded(function () {\n        console.log(\"播放结束\");\n        setIsPlaying(false);\n      });\n      audioContext.current.onError(function (res) {\n        console.error(\"播放错误\", res);\n        setAudioError(\"\\u64AD\\u653E\\u9519\\u8BEF: \".concat(res.errMsg));\n        setIsPlaying(false);\n      });\n      audioContext.current.onCanplay(function () {\n        console.log(\"音频就绪\");\n      });\n\n      // 添加更多日志\n      audioContext.current.onWaiting(function () {\n        console.log(\"音频加载中\");\n      });\n\n      // 添加时间更新监听\n      audioContext.current.onTimeUpdate(function () {\n        setCurrentTime(audioContext.current.currentTime);\n        if (duration === 0) {\n          setDuration(audioContext.current.duration);\n        }\n      });\n    }\n  };\n\n  // 处理进度条改变\n  var handleSliderChange = function handleSliderChange(e) {\n    if (!audioContext.current) return;\n    var value = e.detail.value;\n    audioContext.current.seek(value);\n    setCurrentTime(value);\n  };\n\n  // 格式化时间\n  var formatTime = function formatTime(time) {\n    var minutes = Math.floor(time / 60);\n    var seconds = Math.floor(time % 60);\n    return \"\".concat(minutes.toString().padStart(2, '0'), \":\").concat(seconds.toString().padStart(2, '0'));\n  };\n\n  // 切换播放速度\n  var togglePlaybackRate = function togglePlaybackRate() {\n    if (!audioContext.current) return;\n    var newRate = isSlowMode ? 1.0 : 0.7;\n    audioContext.current.playbackRate = newRate;\n    setIsSlowMode(!isSlowMode);\n  };\n\n  // 播放音频\n  var playAudio = function playAudio() {\n    if (!audioContext.current) {\n      console.error(\"音频上下文未初始化\");\n      return;\n    }\n    try {\n      if (isPlaying) {\n        audioContext.current.pause();\n      } else {\n        audioContext.current.play();\n      }\n    } catch (error) {\n      console.error(\"播放操作失败\", error);\n      setAudioError(\"\\u64AD\\u653E\\u64CD\\u4F5C\\u5931\\u8D25: \".concat(error.message));\n    }\n  };\n\n  // 检查答案\n  var checkAnswer = function checkAnswer() {\n    if (!userInput || userInput.trim() === '') {\n      Taro.showToast({\n        title: '请输入答案',\n        icon: 'none',\n        duration: 2000\n      });\n      return;\n    }\n    if (!sentenceStore.currentAudio) {\n      Taro.showToast({\n        title: '请等待题目加载',\n        icon: 'none',\n        duration: 2000\n      });\n      return;\n    }\n    var isAnswerCorrect = sentenceStore.checkAnswer(userInput);\n    setCheckResult(isAnswerCorrect ? \"正确\" : \"错误\");\n  };\n\n  // 直接显示答案\n  var showCurrentAnswer = function showCurrentAnswer() {\n    if (!sentenceStore.currentAudio) {\n      Taro.showToast({\n        title: '请等待题目加载',\n        icon: 'none',\n        duration: 2000\n      });\n      return;\n    }\n    setShowAnswer(true);\n    setCheckResult(\"\");\n  };\n\n  // 下一题\n  var nextQuestion = function nextQuestion() {\n    var _sentenceStore$audioL2;\n    if (!sentenceStore.currentAudio || ((_sentenceStore$audioL2 = sentenceStore.audioList) === null || _sentenceStore$audioL2 === void 0 ? void 0 : _sentenceStore$audioL2.length) === 0) {\n      Taro.showToast({\n        title: '没有更多题目了',\n        icon: 'none',\n        duration: 2000\n      });\n      return;\n    }\n    setUserInput(\"\");\n    setShowAnswer(false);\n    setCheckResult(\"\");\n    sentenceStore.nextSentence();\n    if (autoPlay && audioContext.current) {\n      audioContext.current.play();\n    }\n  };\n  if (!sentenceStore.currentAudio) {\n    return /*#__PURE__*/_jsx(View, {\n      className: \"practice\",\n      children: /*#__PURE__*/_jsx(View, {\n        className: \"loading\",\n        children: \"\\u52A0\\u8F7D\\u4E2D...\"\n      })\n    });\n  }\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"practice\",\n    children: [/*#__PURE__*/_jsxs(View, {\n      className: \"stats-bar\",\n      children: [/*#__PURE__*/_jsxs(View, {\n        className: \"stat-item\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"label\",\n          children: \"\\u5F53\\u524D\\u9898\\u76EE\"\n        }), /*#__PURE__*/_jsxs(Text, {\n          className: \"value\",\n          children: [sentenceStore.currentIndex + 1, \"/\", (_sentenceStore$audioL3 = sentenceStore.audioList) === null || _sentenceStore$audioL3 === void 0 ? void 0 : _sentenceStore$audioL3.length]\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"stat-item\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"label\",\n          children: \"\\u5DF2\\u7B54\\u9898\\u6570\"\n        }), /*#__PURE__*/_jsx(Text, {\n          className: \"value\",\n          children: sentenceStore.totalAttempted\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"stat-item\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"label\",\n          children: \"\\u6B63\\u786E\\u7387\"\n        }), /*#__PURE__*/_jsxs(Text, {\n          className: \"value\",\n          children: [sentenceStore.accuracy, \"%\"]\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"stat-item\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"label\",\n          children: \"\\u6B63\\u786E/\\u9519\\u8BEF\"\n        }), /*#__PURE__*/_jsxs(Text, {\n          className: \"value\",\n          children: [sentenceStore.correctCount, \"/\", sentenceStore.wrongCount]\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(View, {\n      className: \"audio-section\",\n      children: [/*#__PURE__*/_jsxs(View, {\n        className: \"audio-progress\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"time-text\",\n          children: formatTime(currentTime)\n        }), /*#__PURE__*/_jsx(Slider, {\n          className: \"progress-slider\",\n          min: 0,\n          max: duration,\n          value: currentTime,\n          activeColor: \"#07c160\",\n          backgroundColor: \"#e9e9e9\",\n          blockSize: 12,\n          onChange: handleSliderChange\n        }), /*#__PURE__*/_jsx(Text, {\n          className: \"time-text\",\n          children: formatTime(duration)\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"audio-controls\",\n        children: [/*#__PURE__*/_jsx(Button, {\n          className: \"play-btn \".concat(isPlaying ? \"playing\" : \"\"),\n          onClick: playAudio,\n          children: isPlaying ? \"暂停\" : \"播放\"\n        }), /*#__PURE__*/_jsx(View, {\n          className: \"speed-toggle \".concat(isSlowMode ? \"slow\" : \"\"),\n          onClick: togglePlaybackRate,\n          children: /*#__PURE__*/_jsx(Image, {\n            className: \"turtle-icon\",\n            src: \"/assets/icons/turtle.png\",\n            mode: \"aspectFit\"\n          })\n        })]\n      }), audioError && /*#__PURE__*/_jsx(Text, {\n        className: \"error-text\",\n        children: audioError\n      })]\n    }), /*#__PURE__*/_jsx(View, {\n      className: \"input-section\",\n      children: /*#__PURE__*/_jsx(Input, {\n        className: \"dictation-input\",\n        value: userInput,\n        onInput: function onInput(e) {\n          return setUserInput(e.detail.value);\n        },\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u542C\\u5230\\u7684\\u5185\\u5BB9\",\n        disabled: showAnswer\n      })\n    }), checkResult && !showAnswer && /*#__PURE__*/_jsx(View, {\n      className: \"check-result \".concat(checkResult === \"正确\" ? \"correct\" : \"wrong\"),\n      children: /*#__PURE__*/_jsx(Text, {\n        className: \"result-text\",\n        children: checkResult === \"正确\" ? \"回答正确！\" : \"回答错误，请继续努力！\"\n      })\n    }), showAnswer && sentenceStore.currentAudio && /*#__PURE__*/_jsxs(View, {\n      className: \"answer-section\",\n      children: [/*#__PURE__*/_jsxs(View, {\n        className: \"correct-answer\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"label\",\n          children: \"\\u6B63\\u786E\\u7B54\\u6848\\uFF1A\"\n        }), /*#__PURE__*/_jsx(Text, {\n          className: \"text\",\n          children: sentenceStore.currentAudio.sentence.text\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"translation\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"label\",\n          children: \"\\u7FFB\\u8BD1\\uFF1A\"\n        }), /*#__PURE__*/_jsx(Text, {\n          className: \"text\",\n          children: sentenceStore.currentAudio.sentence.translation\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(View, {\n      className: \"control-section\",\n      children: /*#__PURE__*/_jsxs(View, {\n        className: \"auto-play\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          children: \"\\u81EA\\u52A8\\u64AD\\u653E\"\n        }), /*#__PURE__*/_jsx(Switch, {\n          checked: autoPlay,\n          onChange: function onChange(e) {\n            return setAutoPlay(e.detail.value);\n          }\n        })]\n      })\n    }), /*#__PURE__*/_jsx(View, {\n      className: \"button-group\",\n      children: !showAnswer ? /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Button, {\n          className: \"check-btn\",\n          onClick: checkAnswer,\n          children: \"\\u68C0\\u67E5\\u7B54\\u6848\"\n        }), /*#__PURE__*/_jsx(Button, {\n          className: \"show-answer-btn\",\n          onClick: showCurrentAnswer,\n          children: \"\\u663E\\u793A\\u7B54\\u6848\"\n        })]\n      }) : /*#__PURE__*/_jsx(Button, {\n        className: \"next-btn\",\n        onClick: nextQuestion,\n        children: \"\\u4E0B\\u4E00\\u9898\"\n      })\n    })]\n  });\n};\nexport default observer(Practice);","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/practice/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"听写练习\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/practice/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n","function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nexport { _arrayLikeToArray as default };","function _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nexport { _arrayWithHoles as default };","function _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = !0,\n      o = !1;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) {\n        if (Object(t) !== t) return;\n        f = !1;\n      } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = !0, n = r;\n    } finally {\n      try {\n        if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nexport { _iterableToArrayLimit as default };","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nexport { _nonIterableRest as default };","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nfunction _slicedToArray(r, e) {\n  return arrayWithHoles(r) || iterableToArrayLimit(r, e) || unsupportedIterableToArray(r, e) || nonIterableRest();\n}\nexport { _slicedToArray as default };","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? arrayLikeToArray(r, a) : void 0;\n  }\n}\nexport { _unsupportedIterableToArray as default };"],"names":[],"sourceRoot":""}